# 微服务设计

[TOC]

我的第五篇读书笔记

![microservice design](microservice design.jpg)

## 第5章 分解单块系统

### 接缝

- 一起变化的部分放在一起，提升内聚性
- 不相关的部分都分隔开，降低耦合性
- 但是单块系统破坏了这两点
- 识别出哪些部分相关且经常一起变化，哪些部分不相关；这一系统内部不同部分之间的区别就是接缝

### 分解单块系统

- 逐渐的增量式的修改一个单块系统
  - 这样做不会带来太大的负担和成本
  - 不要待到服务大到难以拆分才考虑
- 模块自治
  - 可以提升开发速度，模块间互不影响 
  - 各模块可以采用最适合自己的技术栈
  - 各模块独立测试、部署
  - 单块系统显然做不到这些
- 各模块的负责团队也可以自治了
- 安全性
  - 敏感信息相关的代码可以单独作为一个模块
    - 独立的部署、监控、传输数据的保护措施
- 更清晰的服务间依赖关系
  - 单块系统容易产生杂乱的**面条似的**依赖关系
  - 数据库是这一问题的重点
- 数据库
  - 不使用外键
  - 共享静态/动态数据
    - 共享数据作为单独的服务
  - 事务边界
    - 模块内部可以采用强一致
    - 模块间最终一致
    - 或许可以考虑采用完全异步的事件驱动
    - 如果业务流程在某一步失败了
      - 再试N次
      - 终止整个操作，回滚所有修改
      - 补偿操作
    - 整个业务过程的强一致太慢了
    - 但是其它方案又引入了更多的复杂性，而且无法实现通用
- 对于业务功能，利用服务调用获取数据，而不是直接访问数据库
- 报表类的功能利用服务调用效率太低
  - 可以考虑把数据同步到其它存储设施，在上面完成查询功能导出报表
    - 可以采用另外的存储技术
    - 或者另外的从数据库
  - 或者开放聚合接口
    - 把需要的服务名和参数作为聚合接口的参数
    - 接口收到请求立即返回状态值和TransactionID说明收到请求
    - 处理完成发送消息/事件，把报表存下来
      - 可以作为文件保存到分布式文件系统
      - 或者存到数据库、elasticsearch
    - 请求方发起请求利用TransactionID获得数据
      - 响应可以流式返回



------

申请微信公众号有很长时间了，一直没有想清楚究竟应该发一些什么。后来想应该分享一些自己的原创思想和IT从业感悟，花了很长时间我才接受一个事实：我没有能力分享什么原创思想。T_T

最近我想到平时没事会读各种书，不如就把读书笔记分享到公众号。

> 本人在此做以下承诺
>
> - 我不创造知识，我只是知识的搬运工。
> - 所有文章只在本订阅号发布，同时会同步到github（https://github.com/runfriends/notes.git）
> - 所有内容都是本人平时读书记录的笔记和自己的心得感想
> - 绝不转发、抄袭他人文章，如果我的文章侵犯了您的权益请告知，本人会立即删除，并公开道歉

帖上订阅号二维码：

![qrcode_for_weixin_subscription](https://github.com/runfriends/notes/blob/master/qrcode_for_weixin_subscription.jpg?raw=true)